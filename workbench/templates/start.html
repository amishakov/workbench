{% extends "base.html" %}

{% load i18n workbench %}

{% block content %}
<div class="row">
  <div class="col-md-8 col-md-offset-2">

    <div class="panel panel-default">
      <div class="panel-heading"><h3>Hi, {{ user }}</h3></div>
      <div class="panel-body">
        <a href="{{ user.get_ics_url }}">iCalendar URL</a>
      </div>
    </div>

    {% for app, days in user.future_days %}
      <div class="panel panel-default">
        <div class="panel-heading"><h3>
          <a href="{{ app.get_absolute_url }}">{{ app.title }}</a>
          {% if user.is_admin %}
          <small>
            <a href="{% url 'calendar_app_update' app=app.slug %}">{% trans 'presences' %}</a>
          </small>
          {% endif %}
        </h3></div>
        <div class="panel-body">
          {% if days.0 %}
            <h4>Eigene Tage</h4>
            <div class="cells">
              {% for day in days.0 %}
                <a href="{% url 'calendar_day_detail' pk=day.pk app=app.slug %}" class="cell">
                  {{ day.day|date:"D d.m.Y" }}
                </a>
              {% endfor %}
            </div>
          {% endif %}

          {% if days.1 %}
            <h4>Nicht besetzte Tage</h4>
            <div class="cells">
              {% for day in days.1 %}
                <a href="{% url 'calendar_day_update' pk=day.pk app=app.slug %}" class="cell">
                  {{ day.day|date:"D d.m.Y" }}
                </a>
              {% endfor %}
            </div>
          {% endif %}

          {% with stats=app.stats %}
          <h4>Statistik {{ stats.year }}</h4>
          <div class="cells">
            {% for row in stats.users %}
            <div class="cell with-svg">
              <svg width="32" height="32" style="transform:rotate(-90deg);border-radius:50%">
                <circle r="16" cx="16" cy="16" style="fill:#ecf0f1;stroke:#18bc9c;stroke-width:32;stroke-dasharray:{{ row.reached }} 200"></circle>
              </svg>
              <h5>{{ row.user }}</h5>
              {{ row.handled }} {% if row.target %}/ {{ row.target|stringformat:'.1f' }}{% endif %}
            </div>
            {% endfor %}
          </div>
          {% endwith %}

        </div>
      </div>
    {% endfor %}

  </div>
</div>
{% endblock %}
